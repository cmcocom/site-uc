<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ITIL v4 - Service Management SaaS</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), #1e40af);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .tabs-nav {
            display: flex;
            background: var(--dark);
            overflow-x: auto;
            gap: 5px;
            padding: 5px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            border-radius: 6px;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: white;
            color: var(--dark);
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .form-group label .required {
            color: var(--danger);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .actions-bar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-critical { background: #fecaca; color: #991b1b; }
        .badge-high { background: #fed7aa; color: #9a3412; }
        .badge-medium { background: #fef3c7; color: #92400e; }
        .badge-low { background: #d1fae5; color: #065f46; }
        
        .badge-new { background: #dbeafe; color: #1e40af; }
        .badge-assigned { background: #fef3c7; color: #92400e; }
        .badge-in-progress { background: #fed7aa; color: #9a3412; }
        .badge-resolved { background: #d1fae5; color: #065f46; }
        .badge-closed { background: #e5e7eb; color: #374151; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), #1e40af);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background: var(--light);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .sla-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .sla-ok { background: var(--success); }
        .sla-warning { background: var(--warning); }
        .sla-breached { background: var(--danger); }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .tabs-nav, .actions-bar, .btn { display: none !important; }
            .tab-content { display: block !important; padding: 20px; }
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item:before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--primary);
        }

        .timeline-item:after {
            content: '';
            position: absolute;
            left: -19px;
            top: 18px;
            width: 2px;
            height: 100%;
            background: var(--border);
        }

        .timeline-item:last-child:after {
            display: none;
        }

        .info-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .info-label {
            font-weight: 600;
            color: var(--dark);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--info);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Sistema de Gesti√≥n de Servicios TI - ITIL v4</h1>
            <p>Service Desk | Incident Management | Problem Management | Change Management</p>
        </div>

        <nav class="tabs-nav">
            <button class="tab-btn active" onclick="showTab('dashboard')">
                üìä Dashboard
            </button>
            <button class="tab-btn" onclick="showTab('incidents')">
                üö® Incidentes
            </button>
            <button class="tab-btn" onclick="showTab('service-requests')">
                üìù Solicitudes de Servicio
            </button>
            <button class="tab-btn" onclick="showTab('problems')">
                üîç Problemas
            </button>
            <button class="tab-btn" onclick="showTab('changes')">
                üîÑ Cambios
            </button>
            <button class="tab-btn" onclick="showTab('cmdb')">
                üíæ CMDB
            </button>
            <button class="tab-btn" onclick="showTab('knowledge')">
                üìö Base de Conocimiento
            </button>
            <button class="tab-btn" onclick="showTab('reports')">
                üìà Reportes
            </button>
        </nav>

        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <h2>Panel de Control</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-incidents">0</div>
                    <div class="stat-label">Incidentes Activos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #059669);">
                    <div class="stat-number" id="stat-requests">0</div>
                    <div class="stat-label">Solicitudes Abiertas</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                    <div class="stat-number" id="stat-problems">0</div>
                    <div class="stat-label">Problemas en An√°lisis</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--info), #0891b2);">
                    <div class="stat-number" id="stat-sla">95%</div>
                    <div class="stat-label">Cumplimiento SLA</div>
                </div>
            </div>

            <div class="alert alert-info">
                üí° <strong>Mejores Pr√°cticas ITIL v4:</strong> Este sistema implementa los procesos de Gesti√≥n de Incidentes, Problemas, Cambios y CMDB seg√∫n el marco ITIL v4 para optimizar la entrega de servicios TI.
            </div>

            <h3>Incidentes Cr√≠ticos y de Alta Prioridad</h3>
            <div id="dashboard-critical-incidents"></div>

            <h3>SLAs Pr√≥ximos a Vencer</h3>
            <div id="dashboard-sla-warnings"></div>
        </div>

        <!-- GESTI√ìN DE INCIDENTES -->
        <div id="incidents" class="tab-content">
            <h2>Gesti√≥n de Incidentes</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showIncidentForm()">‚ûï Nuevo Incidente</button>
                <button class="btn btn-info" onclick="exportData('incidents')">üì• Exportar</button>
                <button class="btn btn-warning" onclick="importData('incidents')">üì§ Importar</button>
                <button class="btn btn-success" onclick="printReport('incidents')">üñ®Ô∏è Imprimir</button>
            </div>

            <div id="incident-form" style="display: none;">
                <div class="card">
                    <h3>Registro de Incidente</h3>
                    <form id="form-incident" onsubmit="saveIncident(event)">
                        <div class="form-grid">
                            <!-- Informaci√≥n B√°sica -->
                            <div class="form-group">
                                <label>N√∫mero de Incidente <span class="required">*</span></label>
                                <input type="text" id="inc-number" name="incidentNumber" required placeholder="INC-YYYY-NNNN">
                            </div>
                            
                            <div class="form-group">
                                <label>Fecha/Hora de Registro <span class="required">*</span></label>
                                <input type="datetime-local" id="inc-datetime" name="reportedDate" required>
                            </div>

                            <div class="form-group">
                                <label>Solicitante <span class="required">*</span></label>
                                <input type="text" id="inc-requester" name="requester" required placeholder="Nombre completo">
                            </div>

                            <div class="form-group">
                                <label>Email del Solicitante <span class="required">*</span></label>
                                <input type="email" id="inc-email" name="requesterEmail" required>
                            </div>

                            <div class="form-group">
                                <label>Departamento/√Årea</label>
                                <select id="inc-department" name="department">
                                    <option value="">Seleccionar...</option>
                                    <option value="IT">IT / Sistemas</option>
                                    <option value="RRHH">Recursos Humanos</option>
                                    <option value="Finanzas">Finanzas</option>
                                    <option value="Operaciones">Operaciones</option>
                                    <option value="Ventas">Ventas</option>
                                    <option value="Marketing">Marketing</option>
                                </select>
                            </div>

                            <!-- Clasificaci√≥n y Priorizaci√≥n -->
                            <div class="form-group">
                                <label>Categor√≠a <span class="required">*</span></label>
                                <select id="inc-category" name="category" required onchange="updateSubcategories('incident')">
                                    <option value="">Seleccionar...</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Software">Software</option>
                                    <option value="Red">Red</option>
                                    <option value="Seguridad">Seguridad</option>
                                    <option value="Acceso">Control de Acceso</option>
                                    <option value="Email">Email / Correo</option>
                                    <option value="Telefonia">Telefon√≠a</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Subcategor√≠a</label>
                                <select id="inc-subcategory" name="subcategory">
                                    <option value="">Seleccionar categor√≠a primero...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Impacto <span class="required">*</span></label>
                                <select id="inc-impact" name="impact" required onchange="calculatePriority()">
                                    <option value="">Seleccionar...</option>
                                    <option value="1">1 - Cr√≠tico (M√∫ltiples usuarios/Organizaci√≥n completa)</option>
                                    <option value="2">2 - Alto (Departamento completo)</option>
                                    <option value="3">3 - Medio (Varios usuarios)</option>
                                    <option value="4">4 - Bajo (Usuario individual)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Urgencia <span class="required">*</span></label>
                                <select id="inc-urgency" name="urgency" required onchange="calculatePriority()">
                                    <option value="">Seleccionar...</option>
                                    <option value="1">1 - Cr√≠tica (Trabajo detenido)</option>
                                    <option value="2">2 - Alta (Impacto severo en productividad)</option>
                                    <option value="3">3 - Media (Funcionalidad reducida)</option>
                                    <option value="4">4 - Baja (Inconveniente menor)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Prioridad (Calculada)</label>
                                <input type="text" id="inc-priority" name="priority" readonly style="background: #f3f4f6;">
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="inc-status" name="status" required>
                                    <option value="Nuevo">Nuevo</option>
                                    <option value="Asignado">Asignado</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Pendiente">Pendiente (Esperando Usuario)</option>
                                    <option value="Resuelto">Resuelto</option>
                                    <option value="Cerrado">Cerrado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Asignado a</label>
                                <select id="inc-assigned" name="assignedTo">
                                    <option value="">Sin asignar</option>
                                    <option value="Soporte Nivel 1">Soporte Nivel 1</option>
                                    <option value="Soporte Nivel 2">Soporte Nivel 2</option>
                                    <option value="Soporte Nivel 3">Soporte Nivel 3</option>
                                    <option value="Especialista Redes">Especialista Redes</option>
                                    <option value="Especialista Seguridad">Especialista Seguridad</option>
                                </select>
                            </div>

                            <!-- Configuraci√≥n Item Afectado -->
                            <div class="form-group">
                                <label>CI Afectado (CMDB)</label>
                                <select id="inc-ci" name="configurationItem">
                                    <option value="">Seleccionar...</option>
                                    <option value="WS001">WS001 - Workstation - CEO Office</option>
                                    <option value="SRV001">SRV001 - Server - File Server</option>
                                    <option value="NET001">NET001 - Network - Core Switch</option>
                                    <option value="APP001">APP001 - Application - ERP System</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Ubicaci√≥n</label>
                                <input type="text" id="inc-location" name="location" placeholder="Ej: Edificio A, Piso 3, Oficina 301">
                            </div>

                            <!-- SLA -->
                            <div class="form-group">
                                <label>SLA de Respuesta (horas)</label>
                                <input type="number" id="inc-sla-response" name="slaResponse" value="4" min="1">
                            </div>

                            <div class="form-group">
                                <label>SLA de Resoluci√≥n (horas)</label>
                                <input type="number" id="inc-sla-resolution" name="slaResolution" value="24" min="1">
                            </div>
                        </div>

                        <!-- Descripci√≥n -->
                        <div class="form-group">
                            <label>Descripci√≥n Detallada <span class="required">*</span></label>
                            <textarea id="inc-description" name="description" required placeholder="Describa el incidente con el mayor detalle posible..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Pasos para Reproducir</label>
                            <textarea id="inc-steps" name="stepsToReproduce" placeholder="1. Abrir aplicaci√≥n...&#10;2. Hacer clic en..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Soluci√≥n/Notas de Trabajo</label>
                            <textarea id="inc-resolution" name="resolution" placeholder="Descripci√≥n de la soluci√≥n aplicada..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Causa Ra√≠z</label>
                            <textarea id="inc-root-cause" name="rootCause" placeholder="An√°lisis de causa ra√≠z..."></textarea>
                        </div>

                        <!-- Relaciones -->
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Relacionado con Problema</label>
                                <input type="text" id="inc-problem" name="relatedProblem" placeholder="PROB-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Incidente Padre</label>
                                <input type="text" id="inc-parent" name="parentIncident" placeholder="INC-YYYY-NNNN">
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar Incidente</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="incidents-list"></div>
        </div>

        <!-- SOLICITUDES DE SERVICIO -->
        <div id="service-requests" class="tab-content">
            <h2>Solicitudes de Servicio (Service Requests)</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showServiceRequestForm()">‚ûï Nueva Solicitud</button>
                <button class="btn btn-info" onclick="exportData('requests')">üì• Exportar</button>
            </div>

            <div class="alert alert-info">
                üí° Las solicitudes de servicio son peticiones est√°ndar que no requieren diagn√≥stico (Ej: creaci√≥n de usuarios, instalaci√≥n de software, acceso a recursos).
            </div>

            <div id="service-request-form" style="display: none;">
                <div class="card">
                    <h3>Nueva Solicitud de Servicio</h3>
                    <form id="form-service-request" onsubmit="saveServiceRequest(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>N√∫mero de Solicitud <span class="required">*</span></label>
                                <input type="text" id="sr-number" name="requestNumber" required placeholder="SR-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Fecha/Hora <span class="required">*</span></label>
                                <input type="datetime-local" id="sr-datetime" name="requestedDate" required>
                            </div>

                            <div class="form-group">
                                <label>Solicitante <span class="required">*</span></label>
                                <input type="text" id="sr-requester" name="requester" required>
                            </div>

                            <div class="form-group">
                                <label>Tipo de Solicitud <span class="required">*</span></label>
                                <select id="sr-type" name="requestType" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Nuevo Usuario">Creaci√≥n de Nuevo Usuario</option>
                                    <option value="Acceso">Solicitud de Acceso</option>
                                    <option value="Software">Instalaci√≥n de Software</option>
                                    <option value="Hardware">Provisi√≥n de Hardware</option>
                                    <option value="Cambio Password">Cambio/Reset de Contrase√±a</option>
                                    <option value="Permiso">Cambio de Permisos</option>
                                    <option value="Informaci√≥n">Solicitud de Informaci√≥n</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="sr-status" name="status" required>
                                    <option value="Pendiente Aprobaci√≥n">Pendiente Aprobaci√≥n</option>
                                    <option value="Aprobado">Aprobado</option>
                                    <option value="En Ejecuci√≥n">En Ejecuci√≥n</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Rechazado">Rechazado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Prioridad <span class="required">*</span></label>
                                <select id="sr-priority" name="priority" required>
                                    <option value="Baja">Baja</option>
                                    <option value="Media">Media</option>
                                    <option value="Alta">Alta</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Descripci√≥n <span class="required">*</span></label>
                            <textarea id="sr-description" name="description" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Justificaci√≥n del Negocio</label>
                            <textarea id="sr-justification" name="businessJustification"></textarea>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar Solicitud</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="service-requests-list"></div>
        </div>

        <!-- GESTI√ìN DE PROBLEMAS -->
        <div id="problems" class="tab-content">
            <h2>Gesti√≥n de Problemas</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showProblemForm()">‚ûï Nuevo Problema</button>
                <button class="btn btn-info" onclick="exportData('problems')">üì• Exportar</button>
            </div>

            <div class="alert alert-info">
                üí° Un Problema es la causa ra√≠z de uno o m√°s incidentes. La gesti√≥n de problemas busca prevenir la recurrencia de incidentes.
            </div>

            <div id="problem-form" style="display: none;">
                <div class="card">
                    <h3>Registro de Problema</h3>
                    <form id="form-problem" onsubmit="saveProblem(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>N√∫mero de Problema <span class="required">*</span></label>
                                <input type="text" id="prob-number" name="problemNumber" required placeholder="PROB-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Fecha de Identificaci√≥n <span class="required">*</span></label>
                                <input type="datetime-local" id="prob-datetime" name="identifiedDate" required>
                            </div>

                            <div class="form-group">
                                <label>Categor√≠a <span class="required">*</span></label>
                                <select id="prob-category" name="category" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Software">Software</option>
                                    <option value="Red">Red</option>
                                    <option value="Seguridad">Seguridad</option>
                                    <option value="Proceso">Proceso</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Prioridad <span class="required">*</span></label>
                                <select id="prob-priority" name="priority" required>
                                    <option value="Cr√≠tica">Cr√≠tica</option>
                                    <option value="Alta">Alta</option>
                                    <option value="Media">Media</option>
                                    <option value="Baja">Baja</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="prob-status" name="status" required>
                                    <option value="Identificado">Identificado</option>
                                    <option value="En An√°lisis">En An√°lisis</option>
                                    <option value="Soluci√≥n Conocida">Soluci√≥n Conocida (Known Error)</option>
                                    <option value="Resuelto">Resuelto</option>
                                    <option value="Cerrado">Cerrado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Asignado a</label>
                                <input type="text" id="prob-assigned" name="assignedTo">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Descripci√≥n del Problema <span class="required">*</span></label>
                            <textarea id="prob-description" name="description" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Incidentes Relacionados</label>
                            <input type="text" id="prob-incidents" name="relatedIncidents" placeholder="INC-2024-0001, INC-2024-0005, ...">
                        </div>

                        <div class="form-group">
                            <label>An√°lisis de Causa Ra√≠z</label>
                            <textarea id="prob-root-cause" name="rootCauseAnalysis"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Soluci√≥n Temporal (Workaround)</label>
                            <textarea id="prob-workaround" name="workaround"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Soluci√≥n Permanente</label>
                            <textarea id="prob-solution" name="permanentSolution"></textarea>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar Problema</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="problems-list"></div>
        </div>

        <!-- GESTI√ìN DE CAMBIOS -->
        <div id="changes" class="tab-content">
            <h2>Gesti√≥n de Cambios (Change Management)</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showChangeForm()">‚ûï Nueva RFC</button>
                <button class="btn btn-info" onclick="exportData('changes')">üì• Exportar</button>
            </div>

            <div class="alert alert-info">
                üí° RFC (Request for Change) - Todo cambio en la infraestructura TI debe ser evaluado, aprobado y gestionado para minimizar riesgos.
            </div>

            <div id="change-form" style="display: none;">
                <div class="card">
                    <h3>Solicitud de Cambio (RFC)</h3>
                    <form id="form-change" onsubmit="saveChange(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>N√∫mero RFC <span class="required">*</span></label>
                                <input type="text" id="chg-number" name="changeNumber" required placeholder="CHG-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Tipo de Cambio <span class="required">*</span></label>
                                <select id="chg-type" name="changeType" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Est√°ndar">Est√°ndar (Pre-aprobado)</option>
                                    <option value="Normal">Normal (Requiere aprobaci√≥n CAB)</option>
                                    <option value="Emergencia">Emergencia (Urgente)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Fecha de Solicitud <span class="required">*</span></label>
                                <input type="datetime-local" id="chg-request-date" name="requestDate" required>
                            </div>

                            <div class="form-group">
                                <label>Fecha Planeada de Implementaci√≥n <span class="required">*</span></label>
                                <input type="datetime-local" id="chg-planned-date" name="plannedDate" required>
                            </div>

                            <div class="form-group">
                                <label>Solicitante <span class="required">*</span></label>
                                <input type="text" id="chg-requester" name="requester" required>
                            </div>

                            <div class="form-group">
                                <label>Responsable de Implementaci√≥n</label>
                                <input type="text" id="chg-implementer" name="implementer">
                            </div>

                            <div class="form-group">
                                <label>Riesgo <span class="required">*</span></label>
                                <select id="chg-risk" name="risk" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Bajo">Bajo</option>
                                    <option value="Medio">Medio</option>
                                    <option value="Alto">Alto</option>
                                    <option value="Cr√≠tico">Cr√≠tico</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="chg-status" name="status" required>
                                    <option value="Borrador">Borrador</option>
                                    <option value="Pendiente Aprobaci√≥n">Pendiente Aprobaci√≥n CAB</option>
                                    <option value="Aprobado">Aprobado</option>
                                    <option value="Programado">Programado</option>
                                    <option value="En Implementaci√≥n">En Implementaci√≥n</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Fallido">Fallido</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>CIs Afectados</label>
                                <input type="text" id="chg-cis" name="affectedCIs" placeholder="CI001, CI002, ...">
                            </div>

                            <div class="form-group">
                                <label>Servicios Afectados</label>
                                <input type="text" id="chg-services" name="affectedServices" placeholder="Email, ERP, ...">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Descripci√≥n del Cambio <span class="required">*</span></label>
                            <textarea id="chg-description" name="description" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Justificaci√≥n del Negocio <span class="required">*</span></label>
                            <textarea id="chg-justification" name="businessJustification" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Plan de Implementaci√≥n</label>
                            <textarea id="chg-implementation" name="implementationPlan"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Plan de Rollback/Retroceso</label>
                            <textarea id="chg-rollback" name="rollbackPlan"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Pruebas Post-Implementaci√≥n</label>
                            <textarea id="chg-testing" name="testingPlan"></textarea>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar RFC</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="changes-list"></div>
        </div>

        <!-- CMDB -->
        <div id="cmdb" class="tab-content">
            <h2>Configuration Management Database (CMDB)</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showCIForm()">‚ûï Nuevo CI</button>
                <button class="btn btn-info" onclick="exportData('cmdb')">üì• Exportar</button>
            </div>

            <div class="alert alert-info">
                üí° La CMDB mantiene informaci√≥n detallada de todos los Configuration Items (CIs) y sus relaciones.
            </div>

            <div id="ci-form" style="display: none;">
                <div class="card">
                    <h3>Registro de Configuration Item (CI)</h3>
                    <form id="form-ci" onsubmit="saveCI(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>CI ID <span class="required">*</span></label>
                                <input type="text" id="ci-id" name="ciId" required placeholder="CI-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Nombre <span class="required">*</span></label>
                                <input type="text" id="ci-name" name="ciName" required>
                            </div>

                            <div class="form-group">
                                <label>Tipo de CI <span class="required">*</span></label>
                                <select id="ci-type" name="ciType" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Software">Software</option>
                                    <option value="Network">Network Device</option>
                                    <option value="Server">Server</option>
                                    <option value="Database">Database</option>
                                    <option value="Application">Application</option>
                                    <option value="Service">Service</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="ci-status" name="ciStatus" required>
                                    <option value="En Operaci√≥n">En Operaci√≥n</option>
                                    <option value="Mantenimiento">En Mantenimiento</option>
                                    <option value="Retirado">Retirado</option>
                                    <option value="En Stock">En Stock</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Fabricante</label>
                                <input type="text" id="ci-manufacturer" name="manufacturer">
                            </div>

                            <div class="form-group">
                                <label>Modelo</label>
                                <input type="text" id="ci-model" name="model">
                            </div>

                            <div class="form-group">
                                <label>N√∫mero de Serie</label>
                                <input type="text" id="ci-serial" name="serialNumber">
                            </div>

                            <div class="form-group">
                                <label>Ubicaci√≥n</label>
                                <input type="text" id="ci-location" name="location">
                            </div>

                            <div class="form-group">
                                <label>Propietario/Responsable</label>
                                <input type="text" id="ci-owner" name="owner">
                            </div>

                            <div class="form-group">
                                <label>Fecha de Compra</label>
                                <input type="date" id="ci-purchase-date" name="purchaseDate">
                            </div>

                            <div class="form-group">
                                <label>Fecha Fin de Garant√≠a</label>
                                <input type="date" id="ci-warranty" name="warrantyEnd">
                            </div>

                            <div class="form-group">
                                <label>Criticidad</label>
                                <select id="ci-criticality" name="criticality">
                                    <option value="Baja">Baja</option>
                                    <option value="Media">Media</option>
                                    <option value="Alta">Alta</option>
                                    <option value="Cr√≠tica">Cr√≠tica</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="ci-description" name="description"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Dependencias (CIs relacionados)</label>
                            <input type="text" id="ci-dependencies" name="dependencies" placeholder="CI-001, CI-002, ...">
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar CI</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="cmdb-list"></div>
        </div>

        <!-- BASE DE CONOCIMIENTO -->
        <div id="knowledge" class="tab-content">
            <h2>Base de Conocimiento (Knowledge Base)</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="showKBForm()">‚ûï Nuevo Art√≠culo</button>
                <button class="btn btn-info" onclick="exportData('knowledge')">üì• Exportar</button>
            </div>

            <div class="alert alert-info">
                üí° La Base de Conocimiento almacena soluciones conocidas, procedimientos y documentaci√≥n para resolver incidentes m√°s r√°pido.
            </div>

            <div id="kb-form" style="display: none;">
                <div class="card">
                    <h3>Art√≠culo de Base de Conocimiento</h3>
                    <form id="form-kb" onsubmit="saveKB(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>KB ID <span class="required">*</span></label>
                                <input type="text" id="kb-id" name="kbId" required placeholder="KB-YYYY-NNNN">
                            </div>

                            <div class="form-group">
                                <label>Categor√≠a <span class="required">*</span></label>
                                <select id="kb-category" name="category" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="How-To">How-To / Gu√≠as</option>
                                    <option value="Troubleshooting">Troubleshooting</option>
                                    <option value="FAQ">FAQ</option>
                                    <option value="Known Error">Known Error</option>
                                    <option value="Best Practice">Best Practice</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estado <span class="required">*</span></label>
                                <select id="kb-status" name="status" required>
                                    <option value="Borrador">Borrador</option>
                                    <option value="En Revisi√≥n">En Revisi√≥n</option>
                                    <option value="Publicado">Publicado</option>
                                    <option value="Archivado">Archivado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Autor</label>
                                <input type="text" id="kb-author" name="author">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>T√≠tulo <span class="required">*</span></label>
                            <input type="text" id="kb-title" name="title" required>
                        </div>

                        <div class="form-group">
                            <label>S√≠ntomas/Problema</label>
                            <textarea id="kb-symptoms" name="symptoms"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Soluci√≥n <span class="required">*</span></label>
                            <textarea id="kb-solution" name="solution" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Palabras Clave (Tags)</label>
                            <input type="text" id="kb-tags" name="tags" placeholder="tag1, tag2, tag3">
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ Guardar Art√≠culo</button>
                            <button type="button" class="btn btn-danger" onclick="cancelForm()">‚ùå Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="knowledge-list"></div>
        </div>

        <!-- REPORTES -->
        <div id="reports" class="tab-content">
            <h2>Reportes y M√©tricas ITIL</h2>
            
            <div class="actions-bar">
                <button class="btn btn-primary" onclick="generateReport('summary')">üìä Reporte Ejecutivo</button>
                <button class="btn btn-info" onclick="generateReport('sla')">‚è±Ô∏è Cumplimiento SLA</button>
                <button class="btn btn-success" onclick="generateReport('trends')">üìà Tendencias</button>
                <button class="btn btn-warning" onclick="generateReport('performance')">üéØ Performance</button>
            </div>

            <div id="reports-container">
                <div class="card">
                    <h3>KPIs Principales</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">MTTR (Tiempo Medio de Resoluci√≥n)</div>
                            <div class="stat-number" style="font-size: 1.5rem;">8.5 hrs</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #059669);">
                            <div class="stat-label">First Call Resolution</div>
                            <div class="stat-number" style="font-size: 1.5rem;">72%</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                            <div class="stat-label">Backlog de Tickets</div>
                            <div class="stat-number" style="font-size: 1.5rem;">45</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--info), #0891b2);">
                            <div class="stat-label">Satisfacci√≥n Usuario (CSAT)</div>
                            <div class="stat-number" style="font-size: 1.5rem;">4.3/5</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Distribuci√≥n por Categor√≠a</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Categor√≠a</th>
                                <th>Incidentes</th>
                                <th>% del Total</th>
                                <th>Tiempo Promedio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Hardware</td>
                                <td>45</td>
                                <td>30%</td>
                                <td>6.2 hrs</td>
                            </tr>
                            <tr>
                                <td>Software</td>
                                <td>60</td>
                                <td>40%</td>
                                <td>4.8 hrs</td>
                            </tr>
                            <tr>
                                <td>Red</td>
                                <td>30</td>
                                <td>20%</td>
                                <td>12.5 hrs</td>
                            </tr>
                            <tr>
                                <td>Acceso</td>
                                <td>15</td>
                                <td>10%</td>
                                <td>2.1 hrs</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA DETALLES -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <div id="modal-body"></div>
            <button class="btn btn-primary" onclick="closeModal()">Cerrar</button>
        </div>
    </div>

    <script>
        // ====================
        // CONFIGURACI√ìN Y DATOS
        // ====================
        
        const STORAGE_KEY = 'itil-saas-data-v2';
        
        // Subcategor√≠as por categor√≠a
        const subcategories = {
            'Hardware': ['PC/Laptop', 'Impresora', 'Monitor', 'Teclado/Mouse', 'Servidor', 'Otro Hardware'],
            'Software': ['Aplicaci√≥n de Negocio', 'Sistema Operativo', 'Office', 'Navegador', 'Antivirus', 'Otro Software'],
            'Red': ['Conectividad', 'VPN', 'Wi-Fi', 'Velocidad', 'Firewall', 'Otro Red'],
            'Seguridad': ['Virus/Malware', 'Phishing', 'Acceso no autorizado', 'Vulnerabilidad', 'Otro Seguridad'],
            'Acceso': ['Cuenta bloqueada', 'Reset password', 'Permisos', 'Nuevo usuario', 'Otro Acceso'],
            'Email': ['No recibe emails', 'No env√≠a emails', 'Spam', 'Configuraci√≥n', 'Otro Email'],
            'Telefonia': ['No marca', 'No recibe', 'Calidad de llamada', 'Configuraci√≥n', 'Otro Telefon√≠a']
        };

        // Matriz de prioridad (Impacto x Urgencia)
        const priorityMatrix = {
            '1-1': 'Cr√≠tica', '1-2': 'Alta', '1-3': 'Media', '1-4': 'Baja',
            '2-1': 'Alta', '2-2': 'Alta', '2-3': 'Media', '2-4': 'Baja',
            '3-1': 'Media', '3-2': 'Media', '3-3': 'Media', '3-4': 'Baja',
            '4-1': 'Baja', '4-2': 'Baja', '4-3': 'Baja', '4-4': 'Baja'
        };

        // ====================
        // FUNCIONES GENERALES
        // ====================

        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Desactivar todos los botones
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activar tab seleccionado
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Cargar datos seg√∫n el tab
            loadTabData(tabName);
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'incidents':
                    loadIncidents();
                    break;
                case 'service-requests':
                    loadServiceRequests();
                    break;
                case 'problems':
                    loadProblems();
                    break;
                case 'changes':
                    loadChanges();
                    break;
                case 'cmdb':
                    loadCMDB();
                    break;
                case 'knowledge':
                    loadKnowledge();
                    break;
            }
        }

        function getData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {
                incidents: [],
                serviceRequests: [],
                problems: [],
                changes: [],
                cmdb: [],
                knowledge: []
            };
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function generateId(prefix) {
            const year = new Date().getFullYear();
            const data = getData();
            const type = prefix.toLowerCase() + 's';
            const count = data[type] ? data[type].length + 1 : 1;
            return `${prefix}-${year}-${String(count).padStart(4, '0')}`;
        }

        function updateSubcategories(type) {
            const categorySelect = document.getElementById(`${type === 'incident' ? 'inc' : 'prob'}-category`);
            const subcategorySelect = document.getElementById(`${type === 'incident' ? 'inc' : 'prob'}-subcategory`);
            
            const category = categorySelect.value;
            subcategorySelect.innerHTML = '<option value="">Seleccionar...</option>';
            
            if (category && subcategories[category]) {
                subcategories[category].forEach(sub => {
                    subcategorySelect.innerHTML += `<option value="${sub}">${sub}</option>`;
                });
            }
        }

        function calculatePriority() {
            const impact = document.getElementById('inc-impact').value;
            const urgency = document.getElementById('inc-urgency').value;
            
            if (impact && urgency) {
                const priority = priorityMatrix[`${impact}-${urgency}`];
                document.getElementById('inc-priority').value = priority;
            }
        }

        function cancelForm() {
            document.querySelectorAll('[id$="-form"]').forEach(form => {
                form.style.display = 'none';
                form.querySelector('form').reset();
            });
        }

        // ====================
        // GESTI√ìN DE INCIDENTES
        // ====================

        function showIncidentForm() {
            document.getElementById('incident-form').style.display = 'block';
            document.getElementById('inc-number').value = generateId('INC');
            document.getElementById('inc-datetime').value = new Date().toISOString().slice(0, 16);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveIncident(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const incident = {
                id: formData.get('incidentNumber'),
                type: 'incident',
                reportedDate: formData.get('reportedDate'),
                requester: formData.get('requester'),
                requesterEmail: formData.get('requesterEmail'),
                department: formData.get('department'),
                category: formData.get('category'),
                subcategory: formData.get('subcategory'),
                impact: formData.get('impact'),
                urgency: formData.get('urgency'),
                priority: formData.get('priority'),
                status: formData.get('status'),
                assignedTo: formData.get('assignedTo'),
                configurationItem: formData.get('configurationItem'),
                location: formData.get('location'),
                slaResponse: formData.get('slaResponse'),
                slaResolution: formData.get('slaResolution'),
                description: formData.get('description'),
                stepsToReproduce: formData.get('stepsToReproduce'),
                resolution: formData.get('resolution'),
                rootCause: formData.get('rootCause'),
                relatedProblem: formData.get('relatedProblem'),
                parentIncident: formData.get('parentIncident'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'System User' // En producci√≥n ser√≠a el usuario logueado
            };
            
            const data = getData();
            data.incidents.push(incident);
            saveData(data);
            
            alert('‚úÖ Incidente guardado correctamente');
            cancelForm();
            loadIncidents();
        }

        function loadIncidents() {
            const data = getData();
            const container = document.getElementById('incidents-list');
            
            if (!data.incidents || data.incidents.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay incidentes registrados</p></div>';
                return;
            }
            
            container.innerHTML = data.incidents.map((inc, index) => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <strong>${inc.id}</strong> - ${inc.description.substring(0, 60)}...
                            <br>
                            <small>Reportado: ${new Date(inc.reportedDate).toLocaleString('es-MX')}</small>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span class="badge badge-${getPriorityClass(inc.priority)}">${inc.priority}</span>
                            <span class="badge badge-${getStatusClass(inc.status)}">${inc.status}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Solicitante:</span>
                        <span>${inc.requester} (${inc.requesterEmail})</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Categor√≠a:</span>
                        <span>${inc.category} > ${inc.subcategory}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Asignado a:</span>
                        <span>${inc.assignedTo || 'Sin asignar'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">SLA Resoluci√≥n:</span>
                        <span>
                            <span class="sla-indicator ${getSLAStatus(inc)}"></span>
                            ${inc.slaResolution} horas
                        </span>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-info btn-sm" onclick="viewDetails('incident', ${index})">üëÅÔ∏è Ver Detalles</button>
                        <button class="btn btn-primary btn-sm" onclick="editItem('incident', ${index})">‚úèÔ∏è Editar</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('incidents', ${index})">üóëÔ∏è Eliminar</button>
                        <button class="btn btn-success btn-sm" onclick="printItem('incident', ${index})">üñ®Ô∏è Imprimir</button>
                    </div>
                </div>
            `).join('');
        }

        function getPriorityClass(priority) {
            const map = {
                'Cr√≠tica': 'critical',
                'Alta': 'high',
                'Media': 'medium',
                'Baja': 'low'
            };
            return map[priority] || 'low';
        }

        function getStatusClass(status) {
            const map = {
                'Nuevo': 'new',
                'Asignado': 'assigned',
                'En Progreso': 'in-progress',
                'Resuelto': 'resolved',
                'Cerrado': 'closed'
            };
            return map[status] || 'new';
        }

        function getSLAStatus(item) {
            // L√≥gica simplificada - en producci√≥n calcular√≠as el tiempo real transcurrido
            return 'sla-ok'; // Puede ser: sla-ok, sla-warning, sla-breached
        }

        // ====================
        // SOLICITUDES DE SERVICIO
        // ====================

        function showServiceRequestForm() {
            document.getElementById('service-request-form').style.display = 'block';
            document.getElementById('sr-number').value = generateId('SR');
            document.getElementById('sr-datetime').value = new Date().toISOString().slice(0, 16);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveServiceRequest(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const request = {
                id: formData.get('requestNumber'),
                type: 'serviceRequest',
                requestedDate: formData.get('requestedDate'),
                requester: formData.get('requester'),
                requestType: formData.get('requestType'),
                status: formData.get('status'),
                priority: formData.get('priority'),
                description: formData.get('description'),
                businessJustification: formData.get('businessJustification'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'System User'
            };
            
            const data = getData();
            data.serviceRequests.push(request);
            saveData(data);
            
            alert('‚úÖ Solicitud guardada correctamente');
            cancelForm();
            loadServiceRequests();
        }

        function loadServiceRequests() {
            const data = getData();
            const container = document.getElementById('service-requests-list');
            
            if (!data.serviceRequests || data.serviceRequests.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay solicitudes de servicio registradas</p></div>';
                return;
            }
            
            container.innerHTML = data.serviceRequests.map((sr, index) => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <strong>${sr.id}</strong> - ${sr.requestType}
                            <br>
                            <small>Solicitado: ${new Date(sr.requestedDate).toLocaleString('es-MX')}</small>
                        </div>
                        <div>
                            <span class="badge badge-${getPriorityClass(sr.priority)}">${sr.priority}</span>
                            <span class="badge badge-${getStatusClass(sr.status)}">${sr.status}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Solicitante:</span>
                        <span>${sr.requester}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Descripci√≥n:</span>
                        <span>${sr.description.substring(0, 100)}...</span>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-info btn-sm" onclick="viewDetails('serviceRequest', ${index})">üëÅÔ∏è Ver Detalles</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('serviceRequests', ${index})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // ====================
        // PROBLEMAS
        // ====================

        function showProblemForm() {
            document.getElementById('problem-form').style.display = 'block';
            document.getElementById('prob-number').value = generateId('PROB');
            document.getElementById('prob-datetime').value = new Date().toISOString().slice(0, 16);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveProblem(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const problem = {
                id: formData.get('problemNumber'),
                type: 'problem',
                identifiedDate: formData.get('identifiedDate'),
                category: formData.get('category'),
                priority: formData.get('priority'),
                status: formData.get('status'),
                assignedTo: formData.get('assignedTo'),
                description: formData.get('description'),
                relatedIncidents: formData.get('relatedIncidents'),
                rootCauseAnalysis: formData.get('rootCauseAnalysis'),
                workaround: formData.get('workaround'),
                permanentSolution: formData.get('permanentSolution'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'System User'
            };
            
            const data = getData();
            data.problems.push(problem);
            saveData(data);
            
            alert('‚úÖ Problema guardado correctamente');
            cancelForm();
            loadProblems();
        }

        function loadProblems() {
            const data = getData();
            const container = document.getElementById('problems-list');
            
            if (!data.problems || data.problems.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay problemas registrados</p></div>';
                return;
            }
            
            container.innerHTML = data.problems.map((prob, index) => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <strong>${prob.id}</strong> - ${prob.description.substring(0, 60)}...
                            <br>
                            <small>Identificado: ${new Date(prob.identifiedDate).toLocaleString('es-MX')}</small>
                        </div>
                        <div>
                            <span class="badge badge-${getPriorityClass(prob.priority)}">${prob.priority}</span>
                            <span class="badge badge-${getStatusClass(prob.status)}">${prob.status}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Categor√≠a:</span>
                        <span>${prob.category}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Incidentes Relacionados:</span>
                        <span>${prob.relatedIncidents || 'Ninguno'}</span>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-info btn-sm" onclick="viewDetails('problem', ${index})">üëÅÔ∏è Ver Detalles</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('problems', ${index})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // ====================
        // CAMBIOS
        // ====================

        function showChangeForm() {
            document.getElementById('change-form').style.display = 'block';
            document.getElementById('chg-number').value = generateId('CHG');
            document.getElementById('chg-request-date').value = new Date().toISOString().slice(0, 16);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveChange(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const change = {
                id: formData.get('changeNumber'),
                type: 'change',
                changeType: formData.get('changeType'),
                requestDate: formData.get('requestDate'),
                plannedDate: formData.get('plannedDate'),
                requester: formData.get('requester'),
                implementer: formData.get('implementer'),
                risk: formData.get('risk'),
                status: formData.get('status'),
                affectedCIs: formData.get('affectedCIs'),
                affectedServices: formData.get('affectedServices'),
                description: formData.get('description'),
                businessJustification: formData.get('businessJustification'),
                implementationPlan: formData.get('implementationPlan'),
                rollbackPlan: formData.get('rollbackPlan'),
                testingPlan: formData.get('testingPlan'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'System User'
            };
            
            const data = getData();
            data.changes.push(change);
            saveData(data);
            
            alert('‚úÖ Cambio guardado correctamente');
            cancelForm();
            loadChanges();
        }

        function loadChanges() {
            const data = getData();
            const container = document.getElementById('changes-list');
            
            if (!data.changes || data.changes.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay cambios registrados</p></div>';
                return;
            }
            
            container.innerHTML = data.changes.map((chg, index) => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <strong>${chg.id}</strong> - ${chg.description.substring(0, 60)}...
                            <br>
                            <small>Implementaci√≥n planeada: ${new Date(chg.plannedDate).toLocaleString('es-MX')}</small>
                        </div>
                        <div>
                            <span class="badge badge-${getPriorityClass(chg.risk)}">${chg.risk}</span>
                            <span class="badge badge-${getStatusClass(chg.status)}">${chg.status}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Tipo:</span>
                        <span>${chg.changeType}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Solicitante:</span>
                        <span>${chg.requester}</span>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-info btn-sm" onclick="viewDetails('change', ${index})">üëÅÔ∏è Ver Detalles</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('changes', ${index})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // ====================
        // CMDB
        // ====================

        function showCIForm() {
            document.getElementById('ci-form').style.display = 'block';
            document.getElementById('ci-id').value = generateId('CI');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveCI(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const ci = {
                id: formData.get('ciId'),
                ciName: formData.get('ciName'),
                ciType: formData.get('ciType'),
                ciStatus: formData.get('ciStatus'),
                manufacturer: formData.get('manufacturer'),
                model: formData.get('model'),
                serialNumber: formData.get('serialNumber'),
                location: formData.get('location'),
                owner: formData.get('owner'),
                purchaseDate: formData.get('purchaseDate'),
                warrantyEnd: formData.get('warrantyEnd'),
                criticality: formData.get('criticality'),
                description: formData.get('description'),
                dependencies: formData.get('dependencies'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: 'System User'
            };
            
            const data = getData();
            data.cmdb.push(ci);
            saveData(data);
            
            alert('‚úÖ CI guardado correctamente');
            cancelForm();
            loadCMDB();
        }

        function loadCMDB() {
            const data = getData();
            const container = document.getElementById('cmdb-list');
            
            if (!data.cmdb || data.cmdb.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay Configuration Items registrados</p></div>';
                return;
            }
            
            container.innerHTML = '<table><thead><tr><th>CI ID</th><th>Nombre</th><th>Tipo</th><th>Estado</th><th>Ubicaci√≥n</th><th>Criticidad</th><th>Acciones</th></tr></thead><tbody>' +
                data.cmdb.map((ci, index) => `
                    <tr>
                        <td><strong>${ci.id}</strong></td>
                        <td>${ci.ciName}</td>
                        <td>${ci.ciType}</td>
                        <td><span class="badge badge-${getStatusClass(ci.ciStatus)}">${ci.ciStatus}</span></td>
                        <td>${ci.location}</td>
                        <td><span class="badge badge-${getPriorityClass(ci.criticality)}">${ci.criticality}</span></td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="viewDetails('ci', ${index})">üëÅÔ∏è</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('cmdb', ${index})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('') + '</tbody></table>';
        }

        // ====================
        // BASE DE CONOCIMIENTO
        // ====================

        function showKBForm() {
            document.getElementById('kb-form').style.display = 'block';
            document.getElementById('kb-id').value = generateId('KB');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveKB(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const kb = {
                id: formData.get('kbId'),
                category: formData.get('category'),
                status: formData.get('status'),
                author: formData.get('author'),
                title: formData.get('title'),
                symptoms: formData.get('symptoms'),
                solution: formData.get('solution'),
                tags: formData.get('tags'),
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                views: 0
            };
            
            const data = getData();
            data.knowledge.push(kb);
            saveData(data);
            
            alert('‚úÖ Art√≠culo guardado correctamente');
            cancelForm();
            loadKnowledge();
        }

        function loadKnowledge() {
            const data = getData();
            const container = document.getElementById('knowledge-list');
            
            if (!data.knowledge || data.knowledge.length === 0) {
                container.innerHTML = '<div class="card"><p>No hay art√≠culos en la base de conocimiento</p></div>';
                return;
            }
            
            container.innerHTML = data.knowledge.map((kb, index) => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <strong>${kb.id}</strong> - ${kb.title}
                            <br>
                            <small>Categor√≠a: ${kb.category} | Vistas: ${kb.views}</small>
                        </div>
                        <div>
                            <span class="badge badge-${getStatusClass(kb.status)}">${kb.status}</span>
                        </div>
                    </div>
                    ${kb.tags ? `<div style="margin-top: 10px;"><small>üè∑Ô∏è ${kb.tags}</small></div>` : ''}
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-info btn-sm" onclick="viewDetails('kb', ${index})">üëÅÔ∏è Ver Art√≠culo</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('knowledge', ${index})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // ====================
        // DASHBOARD
        // ====================

        function loadDashboard() {
            const data = getData();
            
            // Actualizar estad√≠sticas
            document.getElementById('stat-incidents').textContent = 
                (data.incidents?.filter(i => i.status !== 'Cerrado').length || 0);
            document.getElementById('stat-requests').textContent = 
                (data.serviceRequests?.filter(r => r.status !== 'Completado').length || 0);
            document.getElementById('stat-problems').textContent = 
                (data.problems?.filter(p => p.status === 'En An√°lisis').length || 0);
            
            // Incidentes cr√≠ticos
            const criticalIncidents = data.incidents?.filter(i => 
                i.priority === 'Cr√≠tica' || i.priority === 'Alta'
            ).slice(0, 5) || [];
            
            const criticalContainer = document.getElementById('dashboard-critical-incidents');
            if (criticalIncidents.length === 0) {
                criticalContainer.innerHTML = '<div class="card"><p>No hay incidentes cr√≠ticos o de alta prioridad</p></div>';
            } else {
                criticalContainer.innerHTML = criticalIncidents.map(inc => `
                    <div class="card">
                        <strong>${inc.id}</strong> - ${inc.description.substring(0, 80)}...
                        <span class="badge badge-${getPriorityClass(inc.priority)}">${inc.priority}</span>
                    </div>
                `).join('');
            }
        }

        // ====================
        // FUNCIONES AUXILIARES
        // ====================

        function viewDetails(type, index) {
            const data = getData();
            let item;
            let title;
            let content = '';
            
            switch(type) {
                case 'incident':
                    item = data.incidents[index];
                    title = `Incidente ${item.id}`;
                    content = `
                        <div class="info-row"><span class="info-label">N√∫mero:</span><span>${item.id}</span></div>
                        <div class="info-row"><span class="info-label">Fecha Reporte:</span><span>${new Date(item.reportedDate).toLocaleString('es-MX')}</span></div>
                        <div class="info-row"><span class="info-label">Solicitante:</span><span>${item.requester} (${item.requesterEmail})</span></div>
                        <div class="info-row"><span class="info-label">Departamento:</span><span>${item.department}</span></div>
                        <div class="info-row"><span class="info-label">Categor√≠a:</span><span>${item.category} > ${item.subcategory}</span></div>
                        <div class="info-row"><span class="info-label">Prioridad:</span><span class="badge badge-${getPriorityClass(item.priority)}">${item.priority}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.status)}">${item.status}</span></div>
                        <div class="info-row"><span class="info-label">Asignado a:</span><span>${item.assignedTo || 'Sin asignar'}</span></div>
                        <div class="info-row"><span class="info-label">CI Afectado:</span><span>${item.configurationItem || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Ubicaci√≥n:</span><span>${item.location || 'N/A'}</span></div>
                        <h3 style="margin-top: 20px;">Descripci√≥n</h3>
                        <p>${item.description}</p>
                        ${item.stepsToReproduce ? `<h3>Pasos para Reproducir</h3><p>${item.stepsToReproduce}</p>` : ''}
                        ${item.resolution ? `<h3>Soluci√≥n</h3><p>${item.resolution}</p>` : ''}
                        ${item.rootCause ? `<h3>Causa Ra√≠z</h3><p>${item.rootCause}</p>` : ''}
                    `;
                    break;
                    
                case 'serviceRequest':
                    item = data.serviceRequests[index];
                    title = `Solicitud ${item.id}`;
                    content = `
                        <div class="info-row"><span class="info-label">N√∫mero:</span><span>${item.id}</span></div>
                        <div class="info-row"><span class="info-label">Tipo:</span><span>${item.requestType}</span></div>
                        <div class="info-row"><span class="info-label">Solicitante:</span><span>${item.requester}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.status)}">${item.status}</span></div>
                        <h3 style="margin-top: 20px;">Descripci√≥n</h3>
                        <p>${item.description}</p>
                        ${item.businessJustification ? `<h3>Justificaci√≥n</h3><p>${item.businessJustification}</p>` : ''}
                    `;
                    break;
                    
                case 'problem':
                    item = data.problems[index];
                    title = `Problema ${item.id}`;
                    content = `
                        <div class="info-row"><span class="info-label">N√∫mero:</span><span>${item.id}</span></div>
                        <div class="info-row"><span class="info-label">Categor√≠a:</span><span>${item.category}</span></div>
                        <div class="info-row"><span class="info-label">Prioridad:</span><span class="badge badge-${getPriorityClass(item.priority)}">${item.priority}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.status)}">${item.status}</span></div>
                        <div class="info-row"><span class="info-label">Incidentes Relacionados:</span><span>${item.relatedIncidents || 'Ninguno'}</span></div>
                        <h3 style="margin-top: 20px;">Descripci√≥n</h3>
                        <p>${item.description}</p>
                        ${item.rootCauseAnalysis ? `<h3>An√°lisis de Causa Ra√≠z</h3><p>${item.rootCauseAnalysis}</p>` : ''}
                        ${item.workaround ? `<h3>Soluci√≥n Temporal</h3><p>${item.workaround}</p>` : ''}
                        ${item.permanentSolution ? `<h3>Soluci√≥n Permanente</h3><p>${item.permanentSolution}</p>` : ''}
                    `;
                    break;
                    
                case 'change':
                    item = data.changes[index];
                    title = `Cambio ${item.id}`;
                    content = `
                        <div class="info-row"><span class="info-label">N√∫mero:</span><span>${item.id}</span></div>
                        <div class="info-row"><span class="info-label">Tipo:</span><span>${item.changeType}</span></div>
                        <div class="info-row"><span class="info-label">Riesgo:</span><span class="badge badge-${getPriorityClass(item.risk)}">${item.risk}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.status)}">${item.status}</span></div>
                        <div class="info-row"><span class="info-label">Fecha Planeada:</span><span>${new Date(item.plannedDate).toLocaleString('es-MX')}</span></div>
                        <h3 style="margin-top: 20px;">Descripci√≥n</h3>
                        <p>${item.description}</p>
                        ${item.implementationPlan ? `<h3>Plan de Implementaci√≥n</h3><p>${item.implementationPlan}</p>` : ''}
                        ${item.rollbackPlan ? `<h3>Plan de Rollback</h3><p>${item.rollbackPlan}</p>` : ''}
                    `;
                    break;
                    
                case 'ci':
                    item = data.cmdb[index];
                    title = `CI ${item.id}`;
                    content = `
                        <div class="info-row"><span class="info-label">ID:</span><span>${item.id}</span></div>
                        <div class="info-row"><span class="info-label">Nombre:</span><span>${item.ciName}</span></div>
                        <div class="info-row"><span class="info-label">Tipo:</span><span>${item.ciType}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.ciStatus)}">${item.ciStatus}</span></div>
                        <div class="info-row"><span class="info-label">Fabricante:</span><span>${item.manufacturer || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Modelo:</span><span>${item.model || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Serial:</span><span>${item.serialNumber || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Ubicaci√≥n:</span><span>${item.location || 'N/A'}</span></div>
                        <div class="info-row"><span class="info-label">Criticidad:</span><span class="badge badge-${getPriorityClass(item.criticality)}">${item.criticality}</span></div>
                        ${item.description ? `<h3 style="margin-top: 20px;">Descripci√≥n</h3><p>${item.description}</p>` : ''}
                    `;
                    break;
                    
                case 'kb':
                    item = data.knowledge[index];
                    title = `${item.id} - ${item.title}`;
                    content = `
                        <div class="info-row"><span class="info-label">Categor√≠a:</span><span>${item.category}</span></div>
                        <div class="info-row"><span class="info-label">Estado:</span><span class="badge badge-${getStatusClass(item.status)}">${item.status}</span></div>
                        <div class="info-row"><span class="info-label">Autor:</span><span>${item.author || 'N/A'}</span></div>
                        ${item.symptoms ? `<h3 style="margin-top: 20px;">S√≠ntomas</h3><p>${item.symptoms}</p>` : ''}
                        <h3>Soluci√≥n</h3>
                        <p>${item.solution}</p>
                        ${item.tags ? `<p><strong>Tags:</strong> ${item.tags}</p>` : ''}
                    `;
                    // Incrementar contador de vistas
                    data.knowledge[index].views++;
                    saveData(data);
                    break;
            }
            
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('detailModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function deleteItem(arrayName, index) {
            if (confirm('¬øEst√° seguro de eliminar este registro?')) {
                const data = getData();
                data[arrayName].splice(index, 1);
                saveData(data);
                loadTabData(document.querySelector('.tab-content.active').id);
                alert('‚úÖ Registro eliminado');
            }
        }

        function exportData(type) {
            const data = getData();
            let exportData;
            let filename;
            
            switch(type) {
                case 'incidents':
                    exportData = data.incidents;
                    filename = 'incidentes';
                    break;
                case 'requests':
                    exportData = data.serviceRequests;
                    filename = 'solicitudes';
                    break;
                case 'problems':
                    exportData = data.problems;
                    filename = 'problemas';
                    break;
                case 'changes':
                    exportData = data.changes;
                    filename = 'cambios';
                    break;
                case 'cmdb':
                    exportData = data.cmdb;
                    filename = 'cmdb';
                    break;
                case 'knowledge':
                    exportData = data.knowledge;
                    filename = 'base-conocimiento';
                    break;
            }
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(type) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        const data = getData();
                        
                        switch(type) {
                            case 'incidents':
                                data.incidents = [...(data.incidents || []), ...importedData];
                                break;
                        }
                        
                        saveData(data);
                        alert('‚úÖ Datos importados correctamente');
                        loadTabData(document.querySelector('.tab-content.active').id);
                    } catch (error) {
                        alert('‚ùå Error al importar: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function printReport(type) {
            window.print();
        }

        function generateReport(reportType) {
            alert(`Generando reporte: ${reportType}... (Esta funcionalidad se implementar√≠a seg√∫n tus necesidades espec√≠ficas)`);
        }

        function editItem(type, index) {
            alert('Funci√≥n de edici√≥n en desarrollo. Por ahora puedes eliminar y crear uno nuevo.');
        }

        function printItem(type, index) {
            // Mostrar detalles y luego imprimir
            viewDetails(type, index);
            setTimeout(() => window.print(), 500);
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Inicializar al cargar
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>
